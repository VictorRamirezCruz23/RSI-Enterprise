<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda de Electrónica</title>
    <link rel="stylesheet" href="https://rsienterprise.com/vista/css/styles.css">
    <link rel="stylesheet" href="https://rsienterprise.com/vista/css/navAdmin.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.9/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
        /* Estilos generales */
        .cuerpo {
            background-color: #000000;
        }

        .card-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 100px);
            padding: 20px;
        }

        /* Grid adaptable con tarjetas del mismo tamaño */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr)); /* Se adapta al tamaño */
            gap: 30px;
            max-width: 1400px;
            width: 100%;
            justify-content: center; /* 🔥 Centrado horizontal */
            place-items: center; /* 🔥 Centrado vertical si hay menos de 3 tarjetas */
        }

        /* Tarjetas con tamaño fijo */
        .card-item {
            text-decoration: none;
            background-color: #1d1d1d;
            border-radius: 20px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            padding: 40px;
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            color: #ffffff;
            width: 100%;
            max-width: 360px; /* 🔥 Todas las tarjetas tendrán el mismo ancho */
            height: 280px; /* 🔥 Todas tendrán la misma altura */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .card-item:hover {
            transform: translateY(-12px);
            box-shadow: 
                0 10px 20px rgba(0, 0, 0, 0.3), 
                0 0 25px rgba(255, 215, 0, 0.9);
        }

        /* Íconos */
        .card-item .icon {
            font-size: 80px; /* Íconos más grandes */
            margin-bottom: 15px;
            color: #FFD700;
        }

        /* Títulos */
        .card-item h2 {
            font-size: 28px;
            margin-bottom: 10px;
            color: #ffffff;
        }

        /* Contadores */
        .card-item .count {
            font-weight: bold;
            color: #FFD700;
        }

        /* 📌 Responsividad */

        /* Para tablets (menos de 1024px) */
        @media (max-width: 1024px) {
            .card-grid {
                grid-template-columns: repeat(2, 1fr); /* 2 columnas */
                gap: 20px;
                place-items: center;
            }

            .card-item {
                max-width: 400px;
                height: 230px;
            }

            .card-item .icon {
                font-size: 70px;
            }

            .card-item h2 {
                font-size: 26px;
            }
        }

        /* Para móviles (menos de 600px) */
        @media (max-width: 600px) {
            .card-grid {
                grid-template-columns: repeat(1, 1fr); /* 1 columna */
                gap: 15px;
                place-items: center;
            }

            .card-item {
                max-width: 350px;
                height: 220px;
            }

            .card-item .icon {
                font-size: 60px;
            }

            .card-item h2 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body class="cuerpo">
    <header class="nan_header">
        <nav class="nan_navbar">
            <div class="nan_logo">
                <img src="https://rsienterprise.com/vista/css/img/LOGO BLANCO.png" alt="Logo">
            </div>
            <button class="nan_hamburger">&#9776;</button>
            <button class="nan_close" style="display: none;">&times;</button>
            <ul class="nan_menu">
                <li><a href="#" id="cerrarSesion"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</a></li>
            </ul>           
        </nav>
    </header>
    <br><br>

    <div class="card-container">
        <div class="card-grid">
            <a href="productoscom.html" class="card-item">
                <div class="icon"><i class="fas fa-box"></i></div>
                <h2>Productos</h2>
                <p>Productos: <span class="count" id="ProductosCount">0</span></p>
            </a>

            <a href="usuariosAdmin.html" class="card-item">
                <div class="icon"><i class="fas fa-users"></i></div>
                <h2>Usuarios</h2>
                <p>Usuarios: <span class="count" id="usuariosCount">0</span></p>
            </a>

            <a href="colaboradores.html" class="card-item">
                <div class="icon"><i class="fas fa-handshake"></i></div>
                <h2>Colaboradores</h2>
                <p>Colaboradores: <span class="count" id="colaboradoresCount">0</span></p>
            </a>

            <a href="ventas.html" class="card-item">
                <div class="icon"><i class="fas fa-chart-line"></i></div>
                <h2>Ventas</h2>
                <p>Ventas: <span class="count" id="ventasCount">0</span></p>
            </a>

            <a href="panelEntregas.html" class="card-item">
                <div class="icon"><i class="fas fa-truck"></i></div>
                <h2>Entregas</h2>
                <p>Entregas: <span class="count" id="entregasCount">0</span></p>
            </a>

            <a href="pedidosFinalizados.html" class="card-item">
                <div class="icon"><i class="fas fa-check-circle"></i></div>
                <h2>Pedidos Finalizados</h2>
                <p>Pedidos finalizados: <span class="count" id="pedidosFinalizadosCount">0</span></p>
            </a>

            <a href="blogs.html" class="card-item">
                <div class="icon"><i class="fas fa-pencil"></i></div>
                <h2>Blogs</h2>
                <p>Blogs: <span class="count" id="blogsCount">0</span></p>
            </a>

            <a href="comentarios.html" class="card-item">
                <div class="icon"><i class="fas fa-comment"></i></div>
                <h2>Comentarios</h2>
                <p>Comentarios: <span class="count" id="comentariosCount">0</span></p>++

            <a href="contactos.html" class="card-item">
                <div class="icon"><i class="fa-solid fa-envelope"></i></div>
                <h2>Contactos</h2>
                <p>Contactos: <span class="count" id="contactanosCount">0</span></p>
            </a>
            
            <a href="carrusel.html" class="card-item">
                <div class="icon"><i class="fa-solid fa-code"></i></div>
                <h2>Index</h2>
                <p>Carruseles: <span class="count" id="carouselsCount">0</span></p>
            </a>

            <a href="admin-asistencia.html" class="card-item">
                <div class="icon"><i class="fa-solid fa-user-check"></i></div>
                <h2>Asistencia</h2>
                <p>Asistencia <span class="count" id="asistenciaCount">5</span></p>
            </a>

            <a href="clientes.html" class="card-item">
                <div class="icon"><i class="fa-solid fa-user"></i></div>
                <h2>Clientes</h2>
                <p>Clientes <span class="count" id="clientesCount">0</span></p>
            </a>


            <a href="../pmcfotos/Qr/GeneradorDeQr.html" class="card-item">
                <div class="icon"><i class="fas fa-box"></i></div>
                <h2>qr</h2>
                <p>qr: <span class="count" id="ProductosCount">0</span></p>
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.6.9/dist/sweetalert2.min.js"></script>
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBJy992gkvsT77-_fMp_O_z99wtjZiK77Y",
            authDomain: "rsienterprise.firebaseapp.com",
            projectId: "rsienterprise",
            storageBucket: "rsienterprise.appspot.com",
            messagingSenderId: "1063117165770",
            appId: "1:1063117165770:web:8555f26b25ae80bc42d033"
        };

        // Configuración de caché
        const CACHE_KEY = 'firestoreDataCache';
        const CACHE_EXPIRATION = 3600000; 

        // Inicializar Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Funciones de caché
        const getCachedData = () => {
            const cachedData = localStorage.getItem(CACHE_KEY);
            return cachedData ? JSON.parse(cachedData) : null;
        };

        const saveToCache = (data) => {
            const cacheData = {
                timestamp: Date.now(),
                data: data
            };
            localStorage.setItem(CACHE_KEY, JSON.stringify(cacheData));
        };

        const isCacheValid = (cachedData) => {
            return cachedData && (Date.now() - cachedData.timestamp) < CACHE_EXPIRATION;
        };

   
        const actualizarContadores = async () => {
            try {
                const cachedData = getCachedData();
                const collections = {
                    Productos: "ProductosCount",
                    usuarios: "usuariosCount",
                    colaboradores: "colaboradoresCount",
                    ventas: "ventasCount",
                    entregas: "entregasCount",
                    pedidosFinalizados: "pedidosFinalizadosCount",
                    blogs: "blogsCount",
                    comentarios: "comentariosCount",
                    contactanos: "contactanosCount",
                    carousels: "carouselsCount",
                     clientes: "clientesCount",
                    asistencias:"asistenciaCount"

                };

                // caché 
                if (isCacheValid(cachedData)) {
                    Object.entries(cachedData.data).forEach(([key, value]) => {
                        document.getElementById(key).textContent = value;
                    });
                    return;
                }

                // nuevos datos
                const newData = {};
                const promises = Object.entries(collections).map(async ([collection, id]) => {
                    const snapshot = await db.collection(collection).get();
                    newData[id] = snapshot.size;
                });

                await Promise.all(promises);

                // Actualizar UI y caché
                Object.entries(newData).forEach(([id, count]) => {
                    document.getElementById(id).textContent = count;
                });
                saveToCache(newData);

            } catch (error) {
                console.error("Error:", error);
                const cachedData = getCachedData();
                if (cachedData) {
                    Object.entries(cachedData.data).forEach(([id, count]) => {
                        document.getElementById(id).textContent = count;
                    });
                }
                Swal.fire("Error", "No se pudieron cargar los datos", "error");
            }
        };

        // Manejo de autenticación
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = "../nav-visitantes/inicio-de-sesion.html";
                return;
            }

            try {
                const userDoc = await db.collection("usuarios").doc(user.uid).get();
                if (!userDoc.exists || userDoc.data().rol !== "admin") {
                    window.location.href = "../nav-visitantes/inicio-de-sesion.html";
                    return;
                }
                actualizarContadores();
            } catch (error) {
                console.error("Error de autenticación:", error);
                window.location.href = "../nav-visitantes/inicio-de-sesion.html";
            }
        });

        // Cerrar sesión
        document.getElementById("cerrarSesion").addEventListener("click", (e) => {
            e.preventDefault();
            Swal.fire({
                title: "¿Cerrar sesión?",
                text: "¿Estás seguro de que quieres salir?",
                icon: "question",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33"
            }).then((result) => {
                if (result.isConfirmed) {
                    auth.signOut().then(() => {
                        localStorage.removeItem(CACHE_KEY); // Limpiar caché
                        window.location.href = "../nav-visitantes/inicio-de-sesion.html";
                    });
                }
            });
        });
    </script>
</body>
</html>