<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-R">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Clientes - RSI Enterprise</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <link rel="stylesheet" href="../css/clientes.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header class="header">
        <nav class="nan_navbar">
            <div class="nan_logo">
                <img src="https://rsienterprise.com/vista/css/img/LOGO BLANCO.png" alt="Logo">
            </div>
            <button class="nan_hamburger" aria-label="Abrir menú">&#9776;</button>
            <button class="nan_close" aria-label="Cerrar menú" style="display: none;">&times;</button>
            <ul class="nan_menu">
                <li><i class="fas fa-home"></i><a href="dashAdmin.html"> Inicio</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="search-add-container">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Buscar clientes...">
            </div>
            <button class="btn-add" id="btn-add-cliente">
                <i class="fas fa-plus"></i> Agregar Cliente
            </button>
        </div>

        <h2><i class="fas fa-users"></i> Lista de Clientes</h2>
        <div class="table-container">
            <table id="clientes-table">
                <thead>
                    <tr>
                        <th><i class="fas fa-hashtag"></i> N° Cliente</th>
                        <th><i class="fas fa-building"></i> Razón Social</th>
                        <th><i class="fas fa-id-card"></i> RFC</th>
                        <th><i class="fas fa-phone"></i> Teléfono</th>
                        <th><i class="fas fa-envelope"></i> Correo</th>
                        <th><i class="fas fa-info-circle"></i> Estatus</th>
                        <th><i class="fas fa-cog"></i> Acciones</th>
                    </tr>
                </thead>
                <tbody id="clientes-body">
                    </tbody>
            </table>
        </div>

        <div class="pagination-container">
            <div class="pagination-info" id="pagination-info"></div>
            <div class="pagination-controls">
                <button id="first-page" class="pagination-btn" title="Primera página" disabled>
                    <i class="fas fa-angle-double-left"></i>
                </button>
                <button id="prev-page" class="pagination-btn" title="Página anterior" disabled>
                    <i class="fas fa-angle-left"></i>
                </button>
                <span id="page-numbers"></span>
                <button id="next-page" class="pagination-btn" title="Página siguiente" disabled>
                    <i class="fas fa-angle-right"></i>
                </button>
                <button id="last-page" class="pagination-btn" title="Última página" disabled>
                    <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="cliente-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="form-title"><i class="fas fa-user-edit"></i> Agregar Nuevo Cliente</h2>
            <form id="cliente-form">
                <input type="hidden" id="cliente-id">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Numero de Cliente"><i class="fas fa-hashtag"></i> Número de Cliente:</label>
                        <input type="text" id="Numero de Cliente" placeholder="Opcional">
                    </div>
                    
                    <div class="form-group">
                        <label for="Razon Social / Nombre"><i class="fas fa-building"></i> Razón Social / Nombre:</label>
                        <input type="text" id="Razon Social / Nombre">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="RFC"><i class="fas fa-id-card"></i> RFC:</label>
                        <input type="text" id="RFC" placeholder="Opcional">
                    </div>
                    
                    <div class="form-group">
                        <label for="Nombre Comercial"><i class="fas fa-store"></i> Nombre Comercial:</label>
                        <input type="text" id="Nombre Comercial" placeholder="Opcional">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Telefono"><i class="fas fa-phone"></i> Teléfono:</label>
                        <input type="tel" id="Telefono">
                    </div>
                    
                    <div class="form-group">
                        <label for="Movil"><i class="fas fa-mobile-alt"></i> Móvil:</label>
                        <input type="tel" id="Movil" placeholder="Opcional">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Correo"><i class="fas fa-envelope"></i> Correo electrónico:</label>
                        <input type="email" id="Correo">
                    </div>
                    
                    <div class="form-group">
                        <label for="Importe (EUR)"><i class="fas fa-euro-sign"></i> Importe (EUR):</label>
                        <input type="number" step="0.01" id="Importe (EUR)" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Importe (MXN)"><i class="fas fa-dollar-sign"></i> Importe (MXN):</label>
                        <input type="number" step="0.01" id="Importe (MXN)" placeholder="0.00">
                    </div>
                    
                    <div class="form-group">
                        <label for="Importe (USD)"><i class="fas fa-dollar-sign"></i> Importe (USD):</label>
                        <input type="number" step="0.01" id="Importe (USD)" placeholder="0.00">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Calle"><i class="fas fa-road"></i> Calle:</label>
                        <input type="text" id="Calle" placeholder="Opcional">
                    </div>
                    
                    <div class="form-group">
                        <label for="No.Exterior"><i class="fas fa-home"></i> No. Exterior:</label>
                        <input type="text" id="No.Exterior" placeholder="Opcional">
                    </div>
                    
                    <div class="form-group">
                        <label for="No.Interior"><i class="fas fa-home"></i> No. Interior:</label>
                        <input type="text" id="No.Interior" placeholder="Opcional">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Colonia"><i class="fas fa-map-marker-alt"></i> Colonia:</label>
                        <input type="text" id="Colonia" placeholder="Opcional">
                    </div>
                    
                    <div class="form-group">
                        <label for="Codigo Postal"><i class="fas fa-mail-bulk"></i> Código Postal:</label>
                        <input type="text" id="Codigo Postal" placeholder="Opcional">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Localidad"><i class="fas fa-map-marked-alt"></i> Localidad:</label>
                        <input type="text" id="Localidad" placeholder="Opcional">
                    </div>
                    
                    <div class="form-group">
                        <label for="Municipio"><i class="fas fa-city"></i> Municipio:</label>
                        <input type="text" id="Municipio" placeholder="Opcional">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Estado"><i class="fas fa-flag"></i> Estado:</label>
                        <input type="text" id="Estado" placeholder="Opcional">
                    </div>
                    
                    <div class="form-group">
                        <label for="Pais"><i class="fas fa-globe-americas"></i> País:</label>
                        <input type="text" id="Pais" value="MEX">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="GLN"><i class="fas fa-barcode"></i> GLN:</label>
                        <input type="text" id="GLN" placeholder="Opcional">
                    </div>
                    
                    <div class="form-group">
                        <label for="Estatus"><i class="fas fa-info-circle"></i> Estatus:</label>
                        <select id="Estatus">
                            <option value="Activo">Activo</option>
                            <option value="Inactivo">Inactivo</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Lista de precios por defecto"><i class="fas fa-tags"></i> Lista de precios por defecto:</label>
                        <input type="text" id="Lista de precios por defecto" placeholder="Opcional">
                    </div>
                    
                    <div class="form-group">
                        <label for="Listas de precios a las que se le puede vender"><i class="fas fa-tag"></i> Listas de precios disponibles:</label>
                        <input type="text" id="Listas de precios a las que se le puede vender" placeholder="Separadas por comas">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Nacionalidad"><i class="fas fa-passport"></i> Nacionalidad:</label>
                        <input type="text" id="Nacionalidad" value="Mexicana">
                    </div>
                    
                    <div class="form-group">
                        <label for="No. de identificacion fiscal"><i class="fas fa-id-card-alt"></i> No. de identificación fiscal:</label>
                        <input type="text" id="No. de identificacion fiscal" placeholder="Opcional">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Referencia"><i class="fas fa-map-pin"></i> Referencia:</label>
                        <input type="text" id="Referencia" placeholder="Opcional">
                    </div>
                    
                    <div class="form-group">
                        <label for="Regimen fiscal"><i class="fas fa-file-invoice-dollar"></i> Régimen fiscal:</label>
                        <input type="text" id="Regimen fiscal" placeholder="Opcional">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="Tipo de Persona"><i class="fas fa-user-tag"></i> Tipo de Persona:</label>
                        <select id="Tipo de Persona">
                            <option value="Física">Física</option>
                            <option value="Moral">Moral</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="Puesto"><i class="fas fa-briefcase"></i> Puesto:</label>
                        <input type="text" id="Puesto" placeholder="Opcional">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="Vende a Credito">
                        <label for="Vende a Credito"><i class="fas fa-hand-holding-usd"></i> Vende a Crédito</label>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="Permite factoraje financiero">
                        <label for="Permite factoraje financiero"><i class="fas fa-file-invoice"></i> Permite factoraje financiero</label>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="¿Es tercero?">
                        <label for="¿Es tercero?"><i class="fas fa-users"></i> ¿Es tercero?</label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn-secondary" id="cancel-btn">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-primary" id="submit-btn">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Inicializa Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBJy992gkvsT77-_fMp_O_z99wtjZiK77Y",
            authDomain: "rsienterprise.firebaseapp.com",
            projectId: "rsienterprise",
            storageBucket: "rsienterprise.appspot.com",
            messagingSenderId: "1063117165770",
            appId: "1:1063117165770:web:8555f26b25ae80bc42d033"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Referencias a elementos del DOM
        const clienteForm = document.getElementById('cliente-form');
        const clientesBody = document.getElementById('clientes-body');
        const clienteIdInput = document.getElementById('cliente-id');
        const formTitle = document.getElementById('form-title');
        const submitBtn = document.getElementById('submit-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const modal = document.getElementById('cliente-modal');
        const btnAddCliente = document.getElementById('btn-add-cliente');
        const spanClose = document.getElementsByClassName('close')[0];
        const searchInput = document.getElementById('search-input');
        
        // Elementos de paginación
        const firstPageBtn = document.getElementById('first-page');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const lastPageBtn = document.getElementById('last-page');
        const pageNumbers = document.getElementById('page-numbers');
        const paginationInfo = document.getElementById('pagination-info');

        // Variables de estado
        let editing = false;
        let currentClienteId = null;
        let currentPage = 1;
        const itemsPerPage = 10;
        let totalItems = 0;
        let totalPages = 1;
        let searchTerm = '';
        let allClientes = [];

        // Función para formatear campos vacíos
        function formatField(value) {
            return value ? value : '<span>No especificado</span>';
        }

        // Cargar todos los clientes
        async function loadAllClientes() {
            try {
                clientesBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Cargando clientes...</td></tr>';
                
                const querySnapshot = await db.collection("clientes").get();
                
                if (querySnapshot.empty) {
                    clientesBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No hay clientes registrados</td></tr>';
                    allClientes = [];
                    totalItems = 0;
                    updatePaginationControls();
                    return;
                }
                
                allClientes = querySnapshot.docs;
                totalItems = allClientes.length;
                
                filterAndPaginateClientes();
                
            } catch (error) {
                console.error("Error al cargar clientes: ", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error de Carga',
                    text: 'No se pudieron cargar los clientes. Revisa la consola.'
                });
                clientesBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Error al cargar clientes</td></tr>';
            }
        }

        // Filtrar y paginar clientes
        function filterAndPaginateClientes() {
            let filteredClientes = [...allClientes];
            
            if (searchTerm) {
                const searchLower = searchTerm.toLowerCase();
                filteredClientes = allClientes.filter(doc => {
                    const data = doc.data();
                    let allFieldsString = '';
                    for (const key in data) {
                        if (data.hasOwnProperty(key)) {
                            const value = data[key];
                            if (value !== null && value !== undefined) {
                                allFieldsString += ' ' + value.toString().toLowerCase();
                            }
                        }
                    }
                    return allFieldsString.includes(searchLower);
                });
            }
            
            totalItems = filteredClientes.length;
            totalPages = Math.ceil(totalItems / itemsPerPage);
            
            if (currentPage > totalPages && totalPages > 0) {
                currentPage = totalPages;
            } else if (totalPages === 0) {
                currentPage = 1;
            }
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredClientes.length);
            const clientesToShow = filteredClientes.slice(startIndex, endIndex);
            
            displayClientes(clientesToShow);
        }

        // ### CORRECCIÓN 1: LEER LOS NUEVOS NOMBRES DE CAMPO ###
        // Mostrar clientes en la tabla
        function displayClientes(clientes) {
            clientesBody.innerHTML = '';
            
            if (clientes.length === 0) {
                clientesBody.innerHTML = '<tr><td colspan="7" style="text-align: center;">No se encontraron clientes</td></tr>';
                updatePaginationControls();
                return;
            }
            
            clientes.forEach(doc => {
                const data = doc.data();
                const row = document.createElement('tr');
                
                // Usar los nombres de campo en camelCase
                const numeroCliente = data.numeroCliente || '';
                const razonSocial = data.razonSocialNombre || '';
                const rfc = data.RFC || '';
                const telefono = data.Telefono || '';
                const email = data.Correo || '';
                const estatus = data.Estatus || '';
                const movil = data.Movil || '';
                
                row.innerHTML = `
                    <td>${formatField(numeroCliente)}</td>
                    <td>${formatField(razonSocial)}</td>
                    <td>${formatField(rfc)}</td>
                    <td>${telefono ? telefono : 'No especificado'} ${movil ? `<br>Móvil: ${movil}` : ''}</td>
                    <td>${formatField(email)}</td>
                    <td>${formatField(estatus)}</td>
                    <td class="actions">
                        <button class="btn-primary" onclick="editCliente('${doc.id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn-danger" onclick="deleteCliente('${doc.id}')">
                            <i class="fas fa-trash-alt"></i> Eliminar
                        </button>
                    </td>
                `;
                
                clientesBody.appendChild(row);
            });
            
            updatePaginationControls();
        }

        // Actualizar controles de paginación
        function updatePaginationControls() {
            const startItem = totalItems > 0 ? (currentPage - 1) * itemsPerPage + 1 : 0;
            const endItem = Math.min(currentPage * itemsPerPage, totalItems);
            paginationInfo.innerHTML = `Mostrando <strong>${startItem} - ${endItem}</strong> de <strong>${totalItems}</strong> clientes`;
            
            firstPageBtn.disabled = currentPage === 1;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
            lastPageBtn.disabled = currentPage === totalPages || totalPages === 0;
            
            pageNumbers.innerHTML = '';
            
            const maxPagesToShow = 5;
            let startPage = 1;
            let endPage = totalPages;
            
            if (totalPages > maxPagesToShow) {
                const maxPagesBeforeCurrent = Math.floor(maxPagesToShow / 2);
                const maxPagesAfterCurrent = Math.ceil(maxPagesToShow / 2) - 1;
                
                if (currentPage <= maxPagesBeforeCurrent) {
                    endPage = maxPagesToShow;
                } else if (currentPage + maxPagesAfterCurrent >= totalPages) {
                    startPage = totalPages - maxPagesToShow + 1;
                } else {
                    startPage = currentPage - maxPagesBeforeCurrent;
                    endPage = currentPage + maxPagesAfterCurrent;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = 'pagination-btn' + (i === currentPage ? ' active' : '');
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    filterAndPaginateClientes();
                });
                pageNumbers.appendChild(pageBtn);
            }
        }

        // Eventos de paginación
        firstPageBtn.addEventListener('click', () => { currentPage = 1; filterAndPaginateClientes(); });
        prevPageBtn.addEventListener('click', () => { if (currentPage > 1) { currentPage--; filterAndPaginateClientes(); } });
        nextPageBtn.addEventListener('click', () => { if (currentPage < totalPages) { currentPage++; filterAndPaginateClientes(); } });
        lastPageBtn.addEventListener('click', () => { currentPage = totalPages; filterAndPaginateClientes(); });

        // Buscador predictivo
        let searchTimeout;
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                searchTerm = searchInput.value.trim();
                currentPage = 1;
                filterAndPaginateClientes();
            }, 300);
        });

        // Abrir modal para nuevo cliente
        btnAddCliente.addEventListener('click', () => {
            editing = false;
            currentClienteId = null;
            formTitle.innerHTML = '<i class="fas fa-user-plus"></i> Agregar Nuevo Cliente';
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Guardar';
            clienteForm.reset();
            modal.style.display = "block";
        });

        // Cerrar modal
        spanClose.addEventListener('click', () => { modal.style.display = "none"; });
        cancelBtn.addEventListener('click', () => { modal.style.display = "none"; });
        window.addEventListener('click', (event) => { if (event.target === modal) { modal.style.display = "none"; } });

        // ### CORRECCIÓN 2: USAR NOMBRES VÁLIDOS AL ENVIAR A FIREBASE ###
        // Agregar o actualizar cliente
        clienteForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Objeto con claves en formato camelCase, válidas para Firestore
            const clienteData = {
                numeroCliente: document.getElementById('Numero de Cliente').value,
                razonSocialNombre: document.getElementById('Razon Social / Nombre').value,
                RFC: document.getElementById('RFC').value,
                nombreComercial: document.getElementById('Nombre Comercial').value,
                Telefono: document.getElementById('Telefono').value,
                Movil: document.getElementById('Movil').value,
                Correo: document.getElementById('Correo').value,
                importeEUR: parseFloat(document.getElementById('Importe (EUR)').value) || 0,
                importeMXN: parseFloat(document.getElementById('Importe (MXN)').value) || 0,
                importeUSD: parseFloat(document.getElementById('Importe (USD)').value) || 0,
                Calle: document.getElementById('Calle').value,
                noExterior: document.getElementById('No.Exterior').value,
                noInterior: document.getElementById('No.Interior').value,
                Colonia: document.getElementById('Colonia').value,
                codigoPostal: document.getElementById('Codigo Postal').value,
                Localidad: document.getElementById('Localidad').value,
                Municipio: document.getElementById('Municipio').value,
                Estado: document.getElementById('Estado').value,
                Pais: document.getElementById('Pais').value,
                GLN: document.getElementById('GLN').value,
                Estatus: document.getElementById('Estatus').value,
                listaPreciosDefecto: document.getElementById('Lista de precios por defecto').value,
                listasPreciosDisponibles: document.getElementById('Listas de precios a las que se le puede vender').value.split(',').map(item => item.trim()),
                Nacionalidad: document.getElementById('Nacionalidad').value,
                noIdentificacionFiscal: document.getElementById('No. de identificacion fiscal').value,
                Referencia: document.getElementById('Referencia').value,
                regimenFiscal: document.getElementById('Regimen fiscal').value,
                tipoPersona: document.getElementById('Tipo de Persona').value,
                Puesto: document.getElementById('Puesto').value,
                vendeACredito: document.getElementById('Vende a Credito').checked ? "SI" : "NO",
                permiteFactoraje: document.getElementById('Permite factoraje financiero').checked ? "SI" : "NO",
                esTercero: document.getElementById('¿Es tercero?').checked ? "SI" : "NO",
                fechaActualizacion: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                if (editing) {
                    await db.collection("clientes").doc(currentClienteId).update(clienteData);
                } else {
                    clienteData.fechaCreacion = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection("clientes").add(clienteData);
                }
                
                modal.style.display = "none";
                
                Swal.fire({
                    icon: 'success',
                    title: '¡Actualización Correcta!',
                    text: 'La información del cliente se guardó exitosamente.',
                    timer: 2000,
                    showConfirmButton: false
                });

                clienteForm.reset();
                loadAllClientes();

            } catch (error) {
                console.error("Error al guardar cliente: ", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Oops... Hubo un error',
                    text: 'No se pudo guardar la información del cliente.'
                });
            }
        });

        // ### CORRECCIÓN 3: LEER LOS NUEVOS NOMBRES AL EDITAR ###
        // Editar cliente
        window.editCliente = async (id) => {
            try {
                const doc = await db.collection("clientes").doc(id).get();
                if (doc.exists) {
                    const cliente = doc.data();
                    
                    // Llenar formulario usando los nombres de campo en camelCase
                    document.getElementById('Numero de Cliente').value = cliente.numeroCliente || '';
                    document.getElementById('Razon Social / Nombre').value = cliente.razonSocialNombre || '';
                    document.getElementById('RFC').value = cliente.RFC || '';
                    document.getElementById('Nombre Comercial').value = cliente.nombreComercial || '';
                    document.getElementById('Telefono').value = cliente.Telefono || '';
                    document.getElementById('Movil').value = cliente.Movil || '';
                    document.getElementById('Correo').value = cliente.Correo || '';
                    document.getElementById('Importe (EUR)').value = cliente.importeEUR || '';
                    document.getElementById('Importe (MXN)').value = cliente.importeMXN || '';
                    document.getElementById('Importe (USD)').value = cliente.importeUSD || '';
                    document.getElementById('Calle').value = cliente.Calle || '';
                    document.getElementById('No.Exterior').value = cliente.noExterior || '';
                    document.getElementById('No.Interior').value = cliente.noInterior || '';
                    document.getElementById('Colonia').value = cliente.Colonia || '';
                    document.getElementById('Codigo Postal').value = cliente.codigoPostal || '';
                    document.getElementById('Localidad').value = cliente.Localidad || '';
                    document.getElementById('Municipio').value = cliente.Municipio || '';
                    document.getElementById('Estado').value = cliente.Estado || '';
                    document.getElementById('Pais').value = cliente.Pais || 'MEX';
                    document.getElementById('GLN').value = cliente.GLN || '';
                    document.getElementById('Estatus').value = cliente.Estatus || 'Activo';
                    document.getElementById('Lista de precios por defecto').value = cliente.listaPreciosDefecto || '';
                    document.getElementById('Listas de precios a las que se le puede vender').value = cliente.listasPreciosDisponibles ? cliente.listasPreciosDisponibles.join(', ') : '';
                    document.getElementById('Nacionalidad').value = cliente.Nacionalidad || 'Mexicana';
                    document.getElementById('No. de identificacion fiscal').value = cliente.noIdentificacionFiscal || '';
                    document.getElementById('Referencia').value = cliente.Referencia || '';
                    document.getElementById('Regimen fiscal').value = cliente.regimenFiscal || '';
                    document.getElementById('Tipo de Persona').value = cliente.tipoPersona || 'Física';
                    document.getElementById('Puesto').value = cliente.Puesto || '';
                    document.getElementById('Vende a Credito').checked = cliente.vendeACredito === "SI";
                    document.getElementById('Permite factoraje financiero').checked = cliente.permiteFactoraje === "SI";
                    document.getElementById('¿Es tercero?').checked = cliente.esTercero === "SI";
                    
                    clienteIdInput.value = id;
                    editing = true;
                    currentClienteId = id;
                    formTitle.innerHTML = '<i class="fas fa-user-edit"></i> Editar Cliente';
                    submitBtn.innerHTML = '<i class="fas fa-save"></i> Actualizar';
                    
                    modal.style.display = "block";
                }
            } catch (error) {
                console.error("Error al cargar cliente para editar: ", error);
                Swal.fire('Error', 'No se pudo cargar la información del cliente para editar.', 'error');
            }
        };

        // Eliminar cliente
        window.deleteCliente = async (id) => {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "¡No podrás revertir esta acción!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sí, ¡eliminar!',
                cancelButtonText: 'Cancelar'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        await db.collection("clientes").doc(id).delete();
                        Swal.fire(
                            '¡Eliminado!',
                            'El cliente ha sido eliminado.',
                            'success'
                        );
                        loadAllClientes();
                        if (currentClienteId === id) {
                            modal.style.display = "none";
                        }
                    } catch (error) {
                        console.error("Error al eliminar cliente: ", error);
                        Swal.fire('Error', 'No se pudo eliminar el cliente.', 'error');
                    }
                }
            });
        };

        // Cargar clientes al iniciar
        document.addEventListener('DOMContentLoaded', loadAllClientes);
    </script>
</body>
</html>